<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>íƒêµ¬í˜• ë””ì§€í„¸ ìˆ˜í•™ êµê³¼ì„œ</title>
    <style>
        /* --- ê¸°ë³¸ ë° ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ --- */
        body { margin: 0; font-family: "ë‚˜ëˆ”ê³ ë”•", Arial, sans-serif; background-color: #f5deb3; color: #333; }
        main { max-width: 900px; background: white; margin: 40px auto; padding: 40px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.15); text-align: center; min-height: 500px; }
        main h2 { color: #8b4513; font-size: 1.6em; }
        main p { font-size: 1.1em; line-height: 1.6; }
        #content-wrapper { display: none; }

        /* --- ì ê¸ˆ í™”ë©´ --- */
        #lock-screen { position: fixed; top:0; left:0; width:100%; height:100%; background-color: #f5deb3; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:2000; color:#8b4513; }
        #password-input { padding:12px; font-size:1.2em; width:200px; border:2px solid #deb887; border-radius:8px; margin-bottom:10px; }
        #password-button { background-color:#deb887; color:white; border:none; padding:10px 20px; font-size:1.1em; cursor:pointer; border-radius:8px; }
        #error-message { color:red; margin-top:10px; font-weight:bold; }

        /* --- í—¤ë” ë° ë‚´ë¹„ê²Œì´ì…˜ --- */
        header { background-color:#deb887; padding:20px; text-align:center; position:sticky; top:0; z-index:1000; }
        header h1 { margin:0; color:white; font-size:1.8em; }
        nav ul { list-style:none; padding:0; margin:10px 0 0 0; display:flex; justify-content:center; gap:25px; }
        nav li { position:relative; }
        nav a { text-decoration:none; color:white; font-weight:bold; padding:6px 12px; border-radius:6px; transition:background 0.3s; display:inline-block; }
        nav a:hover { background-color:#c49a6c; }
        nav ul ul { display:none; position:absolute; top:40px; left:0; background-color:#deb887; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.2); padding:8px 0; min-width:190px; }
        nav ul ul a { color:white; padding:10px 15px; display:block; white-space:nowrap; }
        nav li:hover>ul { display:block; }

        /* --- ë‹‰ë„¤ì„ & ì±„íŒ… --- */
        #nickname-setup { padding:50px; text-align:center; }
        #nickname-input { padding:10px; font-size:1.1em; margin-bottom:15px; width:80%; max-width:300px; border:2px solid #deb887; border-radius:6px; }
        #set-nickname-button { background-color:#8b4513; color:white; border:none; padding:10px 20px; font-size:1.1em; cursor:pointer; border-radius:8px; }
        #chat-container { display:none; width:100%; max-width:600px; margin:0 auto; box-shadow:0 2px 5px rgba(0,0,0,0.1); border-radius:10px; overflow:hidden; background-color:#fffaf0; }
        #chat-messages { height:400px; overflow-y:auto; padding:15px; text-align:left; background-color:#fcf8f0; }
        .user-message { background-color:#ffdcb7; margin-left:auto; text-align:right; padding:5px 10px; border-radius:8px; margin-bottom:5px; }
        .system-message { background-color:#e0e0e0; margin-right:auto; padding:5px 10px; border-radius:8px; margin-bottom:5px; }
        .message-sender { font-size:0.8em; font-weight:bold; color:#8b4513; margin-bottom:2px; display:block; }
        #chat-input-area { display:flex; border-top:1px solid #ccc; }
        #chat-input { flex-grow:1; padding:10px; border:none; font-size:1em; outline:none; }
        #chat-send-button { background-color:#deb887; color:white; border:none; padding:10px 15px; cursor:pointer; font-weight:bold; }

        /* --- íƒêµ¬ í™œë™ iframe --- */
        #inquiry-iframe-container { width:100%; height:600px; max-width:900px; margin:0 auto; display:none; }
        #division-iframe { width:100%; height:100%; border:1px solid #ccc; border-radius:10px; }

        /* --- â˜… ì¶”ê°€ë¨: ë‚˜ì˜ í•™ìŠµ ê¸°ë¡ ìŠ¤íƒ€ì¼ --- */
        #my-study-content { display: none; text-align: left; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #ffcc80; color: #333; }

        /* --- â˜… ì¶”ê°€ë¨: ì¹­ì°¬ ë°°ì§€ ìŠ¤íƒ€ì¼ --- */
        #badge-content { display: none; padding: 20px; background-color: #fff9c4; border-radius: 15px; text-align: center; }
        .badge-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .badge-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0.5; filter: grayscale(100%); transition: transform 0.3s; }
        .badge-card.unlocked { opacity: 1; filter: grayscale(0%); border: 3px solid #ffd700; transform: scale(1.05); box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        .badge-icon { font-size: 3.5em; display: block; margin-bottom: 10px; }
        .badge-title { font-weight: bold; font-size: 1.1em; color: #333; }
        .badge-desc { font-size: 0.9em; color: #666; }

        /* --- í‘¸í„° --- */
        footer { text-align:center; padding:15px; background-color:#deb887; color:white; margin-top:60px; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h2>ìˆ˜í•™ êµê³¼ì„œ ì ê¸ˆ í•´ì œ ğŸ”’</h2>
    <p>ì ‘ì† ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
    <input type="password" id="password-input" placeholder="ìˆ«ì 4ìë¦¬" maxlength="4" onkeydown="if(event.key==='Enter') checkPassword()">
    <button id="password-button" onclick="checkPassword()">í™•ì¸</button>
    <p id="error-message"></p>
</div>

<div id="content-wrapper">
    <header>
        <h1>íƒêµ¬í˜• ë””ì§€í„¸ ìˆ˜í•™ êµê³¼ì„œ</h1>
        <nav>
            <ul>
                <li><a href="#" onclick="showContent('home'); return false;">í™ˆ</a></li>
                <li>
                    <a href="#">ë‹¨ì› í•™ìŠµ â–¼</a>
                    <ul>
                        <li><a href="#" onclick="showInquiry('study1.html'); return false;">1. ë‘ ìë¦¿ìˆ˜ (ë‚˜ë¨¸ì§€ X)</a></li>
                        <li><a href="#" onclick="showInquiry('study2.html'); return false;">2. ë‘ ìë¦¿ìˆ˜ (ë‚˜ë¨¸ì§€ O)</a></li>
                        <li><a href="#" onclick="showInquiry('study3.html'); return false;">3. ì„¸ ìë¦¿ìˆ˜ ë‚˜ëˆ—ì…ˆ</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#">íƒêµ¬ í™œë™ â–¼</a>
                    <ul>
                        <li><a href="#" onclick="showInquiry('apple_division.html'); return false;">1. ì‚¬ê³¼ ë‚˜ëˆ„ê¸°</a></li>
                        <li><a href="#" onclick="showInquiry('sumo.html'); return false;">2. ìˆ˜ëª¨í˜• ì¡°ì‘í•˜ê¸°</a></li>
                        <li><a href="#" onclick="showInquiry('drawing_pad.html'); return false;">3. ì—°ìŠµì¥ (Canvas)</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#">í‰ê°€í•˜ê¸° â–¼</a>
                    <ul>
                        <li><a href="#" onclick="showContent('quiz_2_digit'); return false;">ë‘ ìë¦¿ìˆ˜ ë‚˜ëˆ—ì…ˆ</a></li>
                        <li><a href="#" onclick="showContent('quiz_3_digit'); return false;">ì„¸ ìë¦¿ìˆ˜ ë‚˜ëˆ—ì…ˆ</a></li>
                    </ul>
                </li>
                <li><a href="#" onclick="showChat(); return false;">í† ì˜Â·ìƒê° ë‚˜ëˆ„ê¸°</a></li>
                <li><a href="#" onclick="showContent('badges'); return false;">ì¹­ì°¬ ë°°ì§€</a></li>
                <li><a href="#" onclick="showContent('my_study'); return false;">ë‚˜ì˜ í•™ìŠµ</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div id="home-content">
            <h2>í•¨ê»˜ íƒêµ¬í•˜ë©° ë°°ìš°ëŠ” ìˆ˜í•™ ğŸŒŸ</h2>
            <p>
                ìˆ˜í•™ ê°œë…ì„ ë°°ìš°ê³ , ìŠ¤ìŠ¤ë¡œ íƒêµ¬í•˜ë©°, ì¹œêµ¬ë“¤ê³¼ ìƒê°ì„ ë‚˜ëˆ„ëŠ” ê³µê°„ì´ì—ìš”.<br>
                ì—¬ëŸ¬ë¶„ì˜ ìƒê°ê³¼ ì•„ì´ë””ì–´ê°€ ìˆ˜í•™ì„ ë” ì¬ë¯¸ìˆê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤!
            </p>
        </div>

        <div id="nickname-setup" style="display: none;">
            <h2>ë‹‰ë„¤ì„ ì„¤ì •</h2>
            <input type="text" id="nickname-input" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" onkeydown="if(event.key==='Enter') setNickname()">
            <button onclick="setNickname()" id="set-nickname-button">ì±„íŒ… ì‹œì‘</button>
        </div>
        
        <div id="quiz-2-digit-content" style="display: none;"></div>
        <div id="quiz-3-digit-content" style="display: none;"></div>

        <div id="inquiry-iframe-container">
            <iframe id="division-iframe" src="" title="íƒêµ¬ í™œë™"></iframe>
        </div>

        <div id="my-study-content">
            <h2 style="color: #ff6f00;">ğŸ“Š ë‚˜ì˜ í•™ìŠµ ê¸°ë¡ì¥</h2>
            <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                <p id="stats-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                <button onclick="clearHistory()" style="background: #ef5350; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">ê¸°ë¡ ì´ˆê¸°í™”</button>
            </div>
            <table>
                <thead><tr><th>ë‚ ì§œ</th><th>ìœ í˜•</th><th>ë¬¸ì œ</th><th>ê²°ê³¼</th><th>ë‚´ ë‹µ</th></tr></thead>
                <tbody id="history-table-body"></tbody>
            </table>
        </div>

        <div id="badge-content">
            <h2 style="color: #fbc02d;">ğŸ† ë‚˜ì˜ ëª…ì˜ˆì˜ ì „ë‹¹</h2>
            <p>ë¬¸ì œë¥¼ í’€ê³  ë°°ì§€ë¥¼ ëª¨ì•„ë³´ì„¸ìš”!</p>
            <div class="badge-grid">
                <div class="badge-card" id="badge-1">
                    <span class="badge-icon">ğŸ£</span>
                    <div class="badge-title">ì‹œì‘ì´ ë°˜</div>
                    <div class="badge-desc">ë°°ì§€ í™”ë©´ì— ì²˜ìŒ ë°©ë¬¸í–ˆì–´ìš”.</div>
                </div>
                <div class="badge-card" id="badge-2">
                    <span class="badge-icon">ğŸ¯</span>
                    <div class="badge-title">ì²« ì •ë‹µ</div>
                    <div class="badge-desc">í‰ê°€ ë¬¸ì œ 1ê°œë¥¼ ë§í˜”ì–´ìš”.</div>
                </div>
                <div class="badge-card" id="badge-3">
                    <span class="badge-icon">ğŸ”¥</span>
                    <div class="badge-title">ëˆê¸°ì™•</div>
                    <div class="badge-desc">5ë²ˆ ì´ìƒ ë„ì „í–ˆì–´ìš”.</div>
                </div>
                <div class="badge-card" id="badge-4">
                    <span class="badge-icon">ğŸ‘‘</span>
                    <div class="badge-title">ë‚˜ëˆ—ì…ˆ ë§ˆìŠ¤í„°</div>
                    <div class="badge-desc">3ê°œ ì´ìƒ ë§í˜”ì–´ìš”.</div>
                </div>
            </div>
        </div>

        <div id="chat-container">
            <div id="chat-messages">
                <div class="message-bubble system-message">
                    <span class="message-sender">ì‹œìŠ¤í…œ ì•Œë¦¼</span>
                    í† ì˜/í† ë¡  ì±„íŒ…ë°©ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!
                </div>
            </div>
            <div id="chat-input-area">
                <input type="text" id="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeydown="if(event.key==='Enter') sendMessage()">
                <button id="chat-send-button" onclick="sendMessage()">ì „ì†¡</button>
            </div>
        </div>
    </main>

    <footer>
        <p>Â© 2025 íƒêµ¬í˜• ë””ì§€í„¸ ìˆ˜í•™ êµê³¼ì„œ</p>
    </footer>
</div>

<script>
    // --- 1. ì ê¸ˆ í™”ë©´ ---
    const CORRECT_PASSWORD = "1324";
    const lockScreen = document.getElementById('lock-screen');
    const contentWrapper = document.getElementById('content-wrapper');
    const passwordInput = document.getElementById('password-input');
    const errorMessage = document.getElementById('error-message');

    function checkPassword() {
        if(passwordInput.value === CORRECT_PASSWORD) {
            lockScreen.style.display='none';
            contentWrapper.style.display='block';
            showContent('home');
        } else {
            errorMessage.textContent='ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
            passwordInput.value='';
            passwordInput.focus();
        }
    }
    document.addEventListener('DOMContentLoaded', ()=>{ passwordInput.focus(); });

    // --- 2. í™”ë©´ ì „í™˜ ê´€ë¦¬ ---
    const homeContent = document.getElementById('home-content');
    const chatContainer = document.getElementById('chat-container'); 
    const nicknameSetup = document.getElementById('nickname-setup');
    const inquiryIframeContainer = document.getElementById('inquiry-iframe-container');
    const quiz2DigitContent = document.getElementById('quiz-2-digit-content'); 
    const quiz3DigitContent = document.getElementById('quiz-3-digit-content'); 
    const divisionIframe = document.getElementById('division-iframe');
    
    // â˜… ì¶”ê°€ëœ ë³€ìˆ˜ë“¤
    const myStudyContent = document.getElementById('my-study-content');
    const badgeContent = document.getElementById('badge-content');
    const historyTableBody = document.getElementById('history-table-body');
    const statsText = document.getElementById('stats-text');

    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const nicknameInput = document.getElementById('nickname-input');
    let CURRENT_USER_NICKNAME = ''; 

    function hideAllSections() {
        homeContent.style.display='none';
        chatContainer.style.display='none';
        nicknameSetup.style.display='none';
        inquiryIframeContainer.style.display='none';
        quiz2DigitContent.style.display='none'; 
        quiz3DigitContent.style.display='none';
        myStudyContent.style.display='none'; // â˜…
        badgeContent.style.display='none'; // â˜…
    }

    function showContent(section){
        hideAllSections();
        
        if(section==='home'){ 
            homeContent.style.display='block'; 
            divisionIframe.src = ''; 
        } 
        else if(section==='quiz_2_digit'){
            inquiryIframeContainer.style.display='block';
            divisionIframe.src = 'quiz_2_digit.html'; 
        } 
        else if(section==='quiz_3_digit'){
            inquiryIframeContainer.style.display='block';
            divisionIframe.src = 'quiz_3_digit.html'; 
        }
        // â˜… ë‚˜ì˜ í•™ìŠµ ë³´ê¸°
        else if(section==='my_study'){
            myStudyContent.style.display='block';
            loadHistory();
        }
        // â˜… ì¹­ì°¬ ë°°ì§€ ë³´ê¸°
        else if(section==='badges'){
            badgeContent.style.display='block';
            checkAndUnlockBadges();
        }
    }

    function showInquiry(fileName){
        hideAllSections();
        inquiryIframeContainer.style.display='block';
        divisionIframe.src=fileName;
    }

    function showChat(){
        hideAllSections();
        if(CURRENT_USER_NICKNAME===''){
            nicknameSetup.style.display='block';
            nicknameInput.focus();
        } else {
            chatContainer.style.display='block';
            chatMessages.scrollTop=chatMessages.scrollHeight;
            chatInput.focus();
        }
    }

    function setNickname(){
        const nickname=nicknameInput.value.trim();
        if(nickname.length<2 || nickname.length>10){ alert("ë‹‰ë„¤ì„ì€ 2ì ì´ìƒ 10ì ì´í•˜"); nicknameInput.focus(); return; }
        CURRENT_USER_NICKNAME=nickname;
        nicknameSetup.style.display='none';
        chatContainer.style.display='block';
        receiveSystemMessage(`${CURRENT_USER_NICKNAME} ë‹˜ì´ ì±„íŒ…ë°©ì— ì…ì¥í–ˆìŠµë‹ˆë‹¤.`);
        chatInput.focus();
    }

    function sendMessage(){
        const text=chatInput.value.trim();
        if(text==="") return;
        const bubble=document.createElement('div');
        bubble.classList.add('message-bubble','user-message');
        const sender=document.createElement('span');
        sender.classList.add('message-sender');
        sender.textContent=CURRENT_USER_NICKNAME;
        bubble.appendChild(sender);
        bubble.innerHTML+=text;
        chatMessages.appendChild(bubble);
        chatInput.value='';
        chatMessages.scrollTop=chatMessages.scrollHeight;
    }

    function receiveSystemMessage(text){
        const bubble=document.createElement('div');
        bubble.classList.add('message-bubble','system-message');
        const sender=document.createElement('span');
        sender.classList.add('message-sender');
        sender.textContent='ì‹œìŠ¤í…œ ì•Œë¦¼';
        bubble.appendChild(sender);
        bubble.innerHTML+=text;
        chatMessages.appendChild(bubble);
        chatMessages.scrollTop=chatMessages.scrollHeight;
    }

    // --- â˜… ì¶”ê°€ ê¸°ëŠ¥: í•™ìŠµ ê¸°ë¡ ë° ë°°ì§€ ë¡œì§ ---
    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('mathLearningHistory')) || [];
        const total = history.length;
        const correctCount = history.filter(item => item.isCorrect).length;
        let score = total > 0 ? Math.round((correctCount / total) * 100) : 0;
        
        statsText.innerHTML = `ì´ <strong>${total}</strong>ë¬¸ì œ ì¤‘ <strong>${correctCount}</strong>ê°œ ì •ë‹µ (ì •ë‹µë¥ : ${score}%)`;
        historyTableBody.innerHTML = '';
        
        if (total === 0) {
            historyTableBody.innerHTML = '<tr><td colspan="5" style="padding:20px;">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
        }
        history.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${item.date}</td><td>${item.type}</td><td style="font-weight:bold;">${item.question}</td><td style="color:${item.isCorrect?'green':'red'};font-weight:bold;">${item.isCorrect?'â­•':'âŒ'}</td><td>${item.userAnswer}</td>`;
            historyTableBody.appendChild(row);
        });
    }

    function clearHistory() {
        if(confirm("ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
            localStorage.removeItem('mathLearningHistory');
            loadHistory();
        }
    }

    function checkAndUnlockBadges() {
        const history = JSON.parse(localStorage.getItem('mathLearningHistory')) || [];
        const totalTries = history.length;
        const correctCount = history.filter(item => item.isCorrect).length;

        unlockBadge('badge-1'); // ë°©ë¬¸ ë°°ì§€
        if (correctCount >= 1) unlockBadge('badge-2');
        if (totalTries >= 5) unlockBadge('badge-3');
        if (correctCount >= 3) unlockBadge('badge-4');
    }

    function unlockBadge(id) {
        const el = document.getElementById(id);
        if(el) el.classList.add('unlocked');
    }
</script>
</body>
</html>